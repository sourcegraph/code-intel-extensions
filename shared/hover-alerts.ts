import * as sourcegraph from 'sourcegraph'

export const linkURL = 'https://docs.sourcegraph.com/code_intelligence/explanations/precise_code_intelligence'

function makeSummary(message: string): sourcegraph.MarkupContent {
    return {
        kind: sourcegraph.MarkupKind.Markdown,
        value: `${message} [Learn more about precise code intelligence](${linkURL})`,
    }
}

function makeBadge(lines: string[]): sourcegraph.BadgeAttachmentRenderOptions {
    return { kind: 'info', linkURL, hoverMessage: lines.join(' ') }
}

//
// LSIF

export const lsif: sourcegraph.Badged<sourcegraph.HoverAlert> = {
    type: 'LSIFAvailableNoCaveat',
    summary: makeSummary('Semantic result.'),
    badge: makeBadge([
        "This hover data comes from a pre-computed semantic index of this project's source.",
        'Click to learn how to add this capability to all of your projects!',
    ]),
}

export const lsifPartialHoverOnly: sourcegraph.Badged<sourcegraph.HoverAlert> = {
    type: 'LSIFAvailableNoCaveat',
    summary: makeSummary('Partial semantic result.'),
    badge: makeBadge([
        'It looks like this symbol is defined in another repository that does not have a pre-computed semantic index.',
        'Click to learn how to make these results precise by enabling semantic indexing for that project.',
    ]),
}

export const lsifPartialDefinitionOnly: sourcegraph.Badged<sourcegraph.HoverAlert> = {
    type: 'LSIFAvailableNoCaveat',
    summary: makeSummary('Partial semantic result.'),
    badge: makeBadge([
        'It looks like this symbol is defined in another repository that does not have a pre-computed semantic index.',
        'Click to learn how to make these results precise by enabling semantic indexing for that project.',
    ]),
}

//
// LSP

export const lsp: sourcegraph.Badged<sourcegraph.HoverAlert> = {
    summary: makeSummary('Language server result.'),
    badge: makeBadge([
        'This hover data comes from a language server running in the cloud.',
        'Click to learn how to improve the reliability of this result by enabling semantic indexing.',
    ]),
}

//
// Search

export const searchLSIFSupportRobust: sourcegraph.Badged<sourcegraph.HoverAlert> = {
    summary: makeSummary('Search-based result.'),
    badge: makeBadge([
        'This hover data is generated by a heuristic text-based search.',
        'Click to learn how to make these results precise by enabling semantic indexing for this project.',
    ]),
}

export const searchLSIFSupportExperimental: sourcegraph.Badged<sourcegraph.HoverAlert> = {
    type: 'SearchResultExperimentalLSIFSupport',
    summary: makeSummary('Search-based result.'),
    badge: makeBadge([
        'This hover data is generated by a heuristic text-based search.',
        "Existing semantic indexers for this language aren't totally robust yet, but you can click here to learn how to give them a try.",
    ]),
}

export const searchLSIFSupportNone: sourcegraph.Badged<sourcegraph.HoverAlert> = {
    type: 'SearchResultNoLSIFSupport',
    summary: makeSummary('Search-based result.'),
}
